# AgentCore框架综合系统测试

## 概述

`ComprehensiveSystemTest` 是AgentCore框架的综合系统测试类，旨在验证框架所有核心模块的协同工作能力。该测试类展示了一个完整的多智能体系统的构建、部署和运行过程。

## 测试覆盖的核心组件

### 1. Agent（智能体）
- **AbstractAgent**: 智能体基础实现
- **AgentId**: 智能体身份标识和寻址机制
- **AgentState**: 智能体状态管理
- **生命周期管理**: 初始化、启动、暂停、恢复、停止、销毁

### 2. Message（消息系统）
- **AgentMessage**: 智能体间消息通信
- **MessagePerformative**: 消息语义类型
- **MessagePriority**: 消息优先级
- **消息构建器**: 灵活的消息创建机制

### 3. Container（容器管理）
- **AgentContainer**: 智能体容器
- **ContainerConfig**: 容器配置管理
- **生命周期管理**: 智能体的创建、添加、移除
- **监控统计**: 容器运行状态和性能指标

### 4. Communication（通信系统）
- **MessageRouter**: 消息路由机制
- **Transport**: 传输层抽象
- **MessageSerializer**: 消息序列化
- **分布式通信**: 跨节点消息传输

## 测试场景

### 测试1: 基础框架集成测试
验证所有核心组件能够正确初始化和协同工作：
- 容器创建和配置
- 通信组件初始化
- 智能体创建和注册
- 基础消息通信验证

### 测试2: 多智能体协作场景测试
模拟完整的任务分发和协作处理场景：
- **TaskManagerAgent**: 任务管理和分发
- **ResourceManagerAgent**: 资源分配和管理
- **ProcessorAgent**: 任务处理执行
- **MonitorAgent**: 系统监控
- 协作流程验证

### 测试3: 分布式通信系统测试
测试复杂的消息路由、序列化和传输机制：
- 多容器分布式环境模拟
- **CommunicationNodeAgent**: 通信节点
- **GatewayAgent**: 网关路由
- 跨节点消息传输验证

### 测试4: 容器管理和监控测试
测试容器的高级管理功能和监控能力：
- 动态智能体创建和管理
- 智能体状态监控
- 容器统计信息收集
- 事件监听和处理

### 测试5: 错误处理和恢复机制测试
测试框架的容错能力和恢复机制：
- **FaultyAgent**: 故障智能体模拟
- **RecoveryAgent**: 错误恢复机制
- **StableAgent**: 系统稳定性验证
- 故障隔离和系统恢复

### 测试6: 性能压力测试
测试框架在高负载下的性能表现：
- 大规模智能体创建（30个智能体）
- 高并发消息处理（1000条消息）
- 性能指标统计和验证
- 系统稳定性测试

## 智能体类型

### 核心智能体
- **CoordinatorAgent**: 协调器智能体，负责整体协调
- **WorkerAgent**: 工作智能体，执行具体任务
- **TaskManagerAgent**: 任务管理智能体，分发和管理任务
- **ResourceManagerAgent**: 资源管理智能体，分配系统资源
- **MonitorAgent**: 监控智能体，系统状态监控

### 通信智能体
- **CommunicationNodeAgent**: 通信节点智能体
- **GatewayAgent**: 网关智能体，处理跨节点通信

### 测试智能体
- **DynamicTestAgent**: 动态测试智能体
- **PerformanceTestAgent**: 性能测试智能体
- **StableAgent**: 稳定智能体
- **FaultyAgent**: 故障智能体
- **RecoveryAgent**: 恢复智能体
- **ReplacementAgent**: 替换智能体

## 运行方式

### 1. 直接运行
```bash
cd agentcore-examples
mvn compile exec:java -Dexec.mainClass="com.agentcore.examples.ComprehensiveSystemTest"
```

### 2. IDE运行
在IDE中直接运行 `ComprehensiveSystemTest.main()` 方法

### 3. Maven测试
```bash
mvn test -Dtest=ComprehensiveSystemTest
```

## 预期输出

测试运行时会输出详细的日志信息，包括：

```
=== AgentCore框架综合系统测试开始 ===
--- 测试1: 基础框架集成测试 ---
协调器智能体 Coordinator@192.168.1.100 启动
工作智能体 Worker1@192.168.1.100 启动
工作智能体 Worker2@192.168.1.100 启动
✓ 基础框架集成测试通过

--- 测试2: 多智能体协作场景测试 ---
任务管理智能体 TaskManager@192.168.1.100 启动
开始协作任务: 大规模数据处理任务
分配资源: 10 单位
协作任务完成: 大规模数据处理任务
✓ 多智能体协作场景测试通过 - 处理任务数: 15

--- 测试3: 分布式通信系统测试 ---
通信节点智能体 Node1Agent@192.168.1.100 启动
网关智能体 Gateway1@192.168.1.100 启动
✓ 分布式通信系统测试通过 - 跨节点消息: 20

--- 测试4: 容器管理和监控测试 ---
容器统计信息: ContainerStats{name=MonitoringContainer, running=true, total=10, active=7, suspended=0, errors=3, messages=45, avgTime=12.34ms}
✓ 容器管理和监控测试通过

--- 测试5: 错误处理和恢复机制测试 ---
预期的故障智能体创建异常: 故障智能体启动失败
智能体已恢复正常
✓ 错误处理和恢复机制测试通过

--- 测试6: 性能压力测试 ---
性能指标 - 消息/秒: 125.67, 平均延迟: 7.95ms, 总测试时间: 8456ms
✓ 性能压力测试通过

=== 测试总结 ===
总处理消息数: 1087
总处理时间: 8642ms
平均消息处理时间: 7.95ms
所有测试场景均通过 ✓

=== AgentCore框架综合系统测试完成 ===
```

## 性能指标

测试会收集以下性能指标：
- **消息处理速度**: 消息/秒
- **平均延迟**: 毫秒
- **总处理时间**: 毫秒
- **智能体响应时间**: 毫秒
- **系统吞吐量**: 事务/秒

## 验证标准

### 功能验证
- ✅ 所有智能体成功创建和启动
- ✅ 消息路由和传输正常
- ✅ 容器管理功能完整
- ✅ 错误处理和恢复机制有效

### 性能验证
- ✅ 消息处理速度 > 10条/秒
- ✅ 平均延迟 < 100毫秒
- ✅ 系统稳定性良好
- ✅ 资源使用合理

## 扩展和定制

### 添加新的测试场景
1. 在 `runAllSystemTests()` 方法中添加新的测试方法调用
2. 实现具体的测试逻辑
3. 创建相应的测试智能体类

### 自定义智能体
1. 继承 `AbstractAgent` 类
2. 实现必要的抽象方法
3. 添加特定的业务逻辑
4. 在测试场景中使用

### 修改测试参数
可以通过修改以下参数来调整测试强度：
- `agentCount`: 智能体数量
- `messageCount`: 消息数量
- `timeout`: 超时时间
- `containerConfig`: 容器配置

## 故障排除

### 常见问题
1. **智能体启动失败**: 检查依赖注入和配置
2. **消息路由失败**: 验证智能体注册和路由配置
3. **性能测试超时**: 调整超时时间或减少测试负载
4. **容器统计异常**: 检查监控配置和事件监听器

### 调试建议
1. 启用DEBUG日志级别查看详细信息
2. 使用断点调试关键流程
3. 检查智能体状态和容器统计
4. 验证消息序列化和反序列化

## 总结

`ComprehensiveSystemTest` 提供了AgentCore框架的全面测试覆盖，验证了：
- 框架核心功能的正确性
- 多智能体系统的协作能力
- 分布式通信的可靠性
- 系统的容错和恢复能力
- 高负载下的性能表现

通过运行这个综合测试，可以确保AgentCore框架在实际应用中的稳定性和可靠性。